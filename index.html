<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Shooting Range Deluxe — Doom Weapon</title>
<style>
body{margin:0;background:#111;color:#eee;font-family:Arial,Helvetica,sans-serif;overflow:hidden}
#game{display:block;margin:0 auto;background:#222;cursor:none}
.hud{
  position:absolute;top:10px;left:50%;transform:translateX(-50%);
  display:flex;gap:12px;background:rgba(0,0,0,0.5);
  padding:10px 15px;border-radius:10px;
}
.card{display:flex;flex-direction:column;align-items:center}
.stat{font-size:12px;color:#aaa}
.val{font-size:16px;font-weight:bold}
#centerMsg{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  font-size:28px;font-weight:bold;color:#fff;
  background:rgba(0,0,0,0.7);padding:20px 30px;
  border-radius:14px;display:none;text-align:center;
}
#pauseMenu{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  background:rgba(20,20,40,0.95);padding:20px 30px;
  border-radius:14px;display:none;color:#eee;text-align:center;
}
#pauseMenu label{display:block;margin:10px 0;}
button{padding:6px 12px;border:none;border-radius:6px;background:#333;color:#eee;cursor:pointer}
button:hover{background:#555}
</style>
</head>
<body>
<canvas id="game" width="800" height="600"></canvas>

<div class="hud">
  <div class="card"><div class="stat">Fase</div><div class="val" id="level">1</div></div>
  <div class="card"><div class="stat">Objetivo</div><div class="val" id="goal">500</div></div>
  <div class="card"><div class="stat">Pontos</div><div class="val" id="score">0</div></div>
  <div class="card"><div class="stat">Precisão</div><div class="val" id="acc">0%</div></div>
  <div class="card"><div class="stat">Erros</div><div class="val" id="misses">0</div></div>
  <div class="card"><div class="stat">Arma</div><div class="val" id="weapon">Pistola</div></div>
</div>

<div id="centerMsg"></div>

<div id="pauseMenu">
  <h2>Jogo Pausado</h2>
  <label>Arma:
    <select id="weaponSelect">
      <option value="pistol">Pistola</option>
      <option value="rifle">Rifle</option>
      <option value="shotgun">Shotgun</option>
    </select>
  </label>
  <label>Dificuldade:
    <select id="difficultySelect">
      <option value="easy">Fácil</option>
      <option value="normal" selected>Normal</option>
      <option value="hard">Difícil</option>
      <option value="insane">Insano</option>
    </select>
  </label>
  <button id="resumeBtn">Retomar</button>
</div>

<div class="controls">
  <button id="btnStart">Start</button>
</div>

<script>
// Canvas e HUD
const canvas=document.getElementById('game'),ctx=canvas.getContext('2d');
const ui={
  score:document.getElementById('score'),
  acc:document.getElementById('acc'),
  level:document.getElementById('level'),
  goal:document.getElementById('goal'),
  msg:document.getElementById('centerMsg'),
  weapon:document.getElementById('weapon'),
  misses:document.getElementById('misses'),
  pauseMenu:document.getElementById('pauseMenu'),
  weaponSelect:document.getElementById('weaponSelect'),
  difficultySelect:document.getElementById('difficultySelect'),
  resumeBtn:document.getElementById('resumeBtn')
};

// Carregando a imagem da arma
const weaponImg = new Image();
weaponImg.src = "weapon.png"; // Coloque seu arquivo weapon.png na mesma pasta

// Armas
const WEAPONS={
  pistol:{name:"Pistola",fireRate:0.4,multiplier:1},
  rifle:{name:"Rifle",fireRate:0.15,multiplier:1.2},
  shotgun:{name:"Shotgun",fireRate:1,multiplier:0.6}
};
let currentWeapon=WEAPONS.pistol;
function setWeapon(w){currentWeapon=w;ui.weapon.textContent=w.name;}

// Dificuldade
let difficulty="normal";
const DIFFICULTY={
  easy:{speed:1,spawn:1,score:1},
  normal:{speed:1.2,spawn:1,score:1},
  hard:{speed:1.5,spawn:0.9,score:1.2},
  insane:{speed:2,spawn:0.8,score:1.5}
};

// Estado do jogo
let mouse={x:0,y:0},score=0,shots=0,hits=0,misses=0;
let targets=[],lastFire=0;
let playing=false,paused=false;
let level=1,goal=500,targetSpeed=2;

// Mensagens
function showMsg(txt,time=1500){
  ui.msg.textContent=txt;
  ui.msg.style.display="block";
  if(time>0) setTimeout(()=>{ui.msg.style.display="none";},time);
}

// Próxima fase
function nextLevel(){
  paused = true;
  showMsg("Fase Concluída!",2000);
  setTimeout(()=>{
    level++;
    goal += 500;
    targetSpeed += 1 * DIFFICULTY[difficulty].speed;
    ui.level.textContent = level;
    ui.goal.textContent = goal;
    misses=0; ui.misses.textContent=misses;

    showMsg("Próxima Fase!",1500);
    setTimeout(()=>{paused=false;targets=[];},1500);
  },2000);
}

// Reinicia fase
function restartLevel(msg="Tente novamente"){
  targets=[]; score=0;shots=0;hits=0;misses=0;
  ui.score.textContent=score; ui.acc.textContent="0%"; ui.misses.textContent=misses;
  showMsg(msg);
}

// Alvo
class Target{
  constructor(){
    this.size=30;
    this.y=Math.random()*(canvas.height-150)+70;
    if(Math.random()>0.5){this.x=-this.size;this.vx=targetSpeed;}
    else{this.x=canvas.width+this.size;this.vx=-targetSpeed;}
  }
  update(){
    this.x+=this.vx;
    if(this.x<-this.size||this.x>canvas.width+this.size){
      misses++; ui.misses.textContent=misses;
      if(misses>=15) restartLevel();
      return false;
    }
    return true;
  }
  draw(){
    ctx.fillStyle="red";
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();
    ctx.strokeStyle="white"; ctx.lineWidth=3; ctx.stroke();
  }
  isHit(mx,my){return Math.hypot(mx-this.x,my-this.y)<=this.size;}
}

// Mouse
canvas.addEventListener("mousemove",e=>{
  const r=canvas.getBoundingClientRect();
  mouse.x=e.clientX-r.left; mouse.y=e.clientY-r.top;
});
canvas.addEventListener("click",()=>{
  if(!playing||paused)return;
  const now=performance.now()/1000;
  if(now-lastFire<currentWeapon.fireRate)return;
  lastFire=now; shots++;
  let hit=false;
  targets=targets.filter(t=>{
    if(t.isHit(mouse.x,mouse.y)){
      hit=true;score+=100*currentWeapon.multiplier;hits++;
      return false;
    } return true;
  });
  if(!hit){ misses++; ui.misses.textContent=misses; if(misses>=15) restartLevel();}
  fireTimer=0.1; // recuo da arma
});

// Arma com sprite e recuo
let fireTimer=0;
function drawWeapon(dt){
  if(fireTimer>0) fireTimer-=dt;
  let recoilOffset = fireTimer>0 ? 20*(fireTimer/0.1) : 0;
  let w=weaponImg.width/2||100; // fallback
  let h=weaponImg.height/2||60;
  let x=canvas.width/2 - w/2;
  let y=canvas.height - h - 20 + recoilOffset;

  if(weaponImg.complete){
    ctx.drawImage(weaponImg,x,y,w,h);
  } else {
    // fallback retângulo
    ctx.fillStyle="#999"; ctx.fillRect(x,y,w,h);
  }

  // Flash do tiro
  if(fireTimer>0){
    ctx.fillStyle="orange";
    ctx.beginPath();
    ctx.arc(x+w+15,y+h/2,10,0,Math.PI*2);
    ctx.fill();
  }
}

// Loop principal
let last=performance.now();
function loop(now){
  let dt=(now-last)/1000; last=now;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#0a0e1b"; ctx.fillRect(0,0,canvas.width,canvas.height);

  if(!paused){
    if(targets.length===0 && playing){targets.push(new Target());}
    targets=targets.filter(t=>{t.draw();return t.update();});
  }

  // Mira
  ctx.strokeStyle='#6ee7ff';ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(mouse.x-12,mouse.y);ctx.lineTo(mouse.x+12,mouse.y);
  ctx.moveTo(mouse.x,mouse.y-12);ctx.lineTo(mouse.x,mouse.y+12);
  ctx.stroke();
  ctx.beginPath();ctx.arc(mouse.x,mouse.y,6,0,Math.PI*2);ctx.stroke();

  // HUD
  ui.score.textContent=score;
  ui.acc.textContent=(shots?Math.round((hits/shots)*100):0)+"%";

  if(score>=goal && !paused){nextLevel();}

  drawWeapon(dt);

  requestAnimationFrame(loop);
}
loop();

// Start
document.getElementById("btnStart").onclick=()=>{
  score=0;shots=0;hits=0;misses=0;level=1;goal=500;
  targetSpeed=2*DIFFICULTY[difficulty].speed;
  ui.level.textContent=level;ui.goal.textContent=goal;
  ui.score.textContent=score;ui.acc.textContent="0%";ui.misses.textContent=misses;
  playing=true;paused=false;
  showMsg("Iniciando...");
  canvas.style.cursor="none";
};

// Pause / Resume
window.addEventListener("keydown",e=>{
  if(e.code==="Escape" && playing){
    paused=!paused;
    ui.pauseMenu.style.display=paused?"block":"none";
  }
});

// Pause menu
ui.resumeBtn.onclick=()=>{paused=false;ui.pauseMenu.style.display="none";};
ui.weaponSelect.addEventListener("change",e=>{setWeapon(WEAPONS[e.target.value]);});
ui.difficultySelect.addEventListener("change",e=>{
  difficulty=e.target.value;
  targetSpeed=2*DIFFICULTY[difficulty].speed;
});
</script>
</body>
</html>
